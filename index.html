<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Days - Listen and Write</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root {
    --good: #16a34a;
    --good-bg: #d1fae5;
    --bad: #ef4444;
    --bad-bg: #fee2e2;
    --border: #cbd5e1;
    --bg: #f5f7fb;
    --text: #111827;
    --primary: #0d6efd;
  }
  body {
    margin: 0;
    font-family: system-ui, Arial, sans-serif;
    background: var(--bg);
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }
  .screen { display: none; width: min(900px, 94vw); }
  #startScreen { display: block; }
  .card {
    background: white;
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 28px;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
  }
  h1 { margin-top: 0; margin-bottom: 10px; }
  p { color: #555; margin-bottom: 20px; }
  .btn {
    background: var(--primary);
    color: white;
    border: none;
    border-radius: 8px;
    padding: 10px 18px;
    cursor: pointer;
    font-size: 16px;
  }
  .layout { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
  .column { display: grid; grid-template-rows: repeat(7, auto); gap: 8px; }
  .sound-cell {
    background: #16a34a;
    color: white;
    text-align: center;
    border-radius: 8px;
    font-size: 18px;
    font-weight: bold;
    cursor: pointer;
    height: 40px;
    line-height: 40px;
    user-select: none;
  }
  .input-wrap { display: flex; flex-direction: column; }
  .input-cell {
    height: 40px;
    border: 1.5px solid var(--border);
    border-radius: 8px;
    text-align: center;
    font-weight: bold;
    font-size: 15px;
  }
  .input-cell.correct { background: var(--good-bg); border-color: var(--good); color: #065f46; }
  .input-cell.incorrect { background: var(--bad-bg); border-color: var(--bad); color: #7f1d1d; animation: shake 0.15s linear 1; }
  @keyframes shake { 0%{transform:translateX(0);}25%{transform:translateX(-5px);}50%{transform:translateX(5px);}75%{transform:translateX(-3px);}100%{transform:translateX(0);} }
  .error-msg { display: none; font-size: 12px; color: #b91c1c; text-align: center; margin-top: 4px; }
  .error-msg.show { display: block; }
  #goodJob {
    display: none; position: fixed; inset: 0; z-index: 30; pointer-events: none;
    font-weight: 900; color: #10b981; font-size: min(18vw, 140px);
    justify-content: center; align-items: center; text-shadow: 0 6px 24px rgba(16, 185, 129, 0.4);
  }
  #confetti { position: fixed; inset: 0; pointer-events: none; z-index: 25; }
  .toolbar { text-align: center; margin-top: 16px; }
</style>
</head>
<body>
<section id="startScreen" class="screen">
  <div class="card">
    <h1>Days - Listen and Write</h1>
    <p>Click each sound button, listen to the day in Spanish, and write it correctly.</p>
    <button class="btn" id="startBtn">Start</button>
  </div>
</section>

<section id="gameScreen" class="screen">
  <div class="card">
    <h1>Days - Listen and Write</h1>
    <div class="layout">
      <div id="soundList" class="column"></div>
      <div id="inputList" class="column"></div>
    </div>
    <div class="toolbar">
      <button class="btn" id="restartBtn">Restart</button>
    </div>
  </div>
</section>

<div id="goodJob">GOOD JOB!</div>
<canvas id="confetti"></canvas>

<script>
const ES = ["Lunes","Martes","MiÃ©rcoles","Jueves","Viernes","SÃ¡bado","Domingo"];
let shuffled = [];
let matches = 0;
let confettiRunning = false;
let rafId = null;
let pieces = [];

const startScreen = document.getElementById("startScreen");
const gameScreen = document.getElementById("gameScreen");
const soundList = document.getElementById("soundList");
const inputList = document.getElementById("inputList");
const goodJobEl = document.getElementById("goodJob");
const confettiCv = document.getElementById("confetti");
const ctx = confettiCv.getContext("2d");

document.getElementById("startBtn").addEventListener("click", () => {
  startScreen.style.display = "none";
  gameScreen.style.display = "block";
  initGame();
});
document.getElementById("restartBtn").addEventListener("click", restartGame);

function initGame() {
  stopConfetti();
  goodJobEl.style.display = "none";
  matches = 0;
  soundList.innerHTML = "";
  inputList.innerHTML = "";
  shuffled = ES.slice().sort(() => Math.random() - 0.5);

  shuffled.forEach((day) => {
    const soundBtn = document.createElement("div");
    soundBtn.className = "sound-cell";
    soundBtn.textContent = "ðŸ”Š";
    soundBtn.addEventListener("click", () => playSound(day));
    soundList.appendChild(soundBtn);

    const wrap = document.createElement("div");
    wrap.className = "input-wrap";

    const input = document.createElement("input");
    input.type = "text";
    input.className = "input-cell";
    input.placeholder = "Write in Spanish";

    const err = document.createElement("div");
    err.className = "error-msg";
    err.textContent = "Incorrect. Try again!";

    input.addEventListener("input", () => {
      input.classList.remove("incorrect");
      err.classList.remove("show");
      if (equalsNormalized(input.value, day)) markCorrect(input, err, day);
    });
    input.addEventListener("keydown", (e) => { if (e.key === "Enter") validate(input, err, day); });
    input.addEventListener("blur", () => validate(input, err, day));

    wrap.appendChild(input);
    wrap.appendChild(err);
    inputList.appendChild(wrap);
  });
}

function playSound(text) {
  let u = new SpeechSynthesisUtterance(text);
  u.lang = "es-ES";
  speechSynthesis.speak(u);
}

function validate(input, err, correct) {
  if (input.disabled) return;
  const value = input.value.trim();
  if (!value) return;
  if (equalsNormalized(value, correct)) markCorrect(input, err, correct);
  else { input.classList.add("incorrect"); err.classList.add("show"); }
}

function markCorrect(input, err, correct) {
  if (!input.classList.contains("correct")) {
    input.value = correct;
    input.classList.add("correct");
    err.classList.remove("show");
    input.disabled = true;
    matches++;
    if (matches === 7) celebrate();
  }
}

function equalsNormalized(a,b){ return normalize(a)===normalize(b); }
function normalize(s){ return s.toLowerCase().normalize("NFD").replace(/\p{Diacritic}/gu,"").trim(); }

function celebrate() { goodJobEl.style.display="flex"; startConfetti(); }
function restartGame() { initGame(); }

function startConfetti() {
  if(confettiRunning) return;
  confettiRunning=true; resizeCanvas(); pieces=createPieces(200); animate(); window.addEventListener("resize",resizeCanvas);
}
function stopConfetti() {
  confettiRunning=false; if(rafId) cancelAnimationFrame(rafId); ctx.clearRect(0,0,confettiCv.width,confettiCv.height);
  window.removeEventListener("resize",resizeCanvas);
}
function resizeCanvas(){ confettiCv.width=window.innerWidth; confettiCv.height=window.innerHeight; }
function createPieces(n){
  const arr=[]; for(let i=0;i<n;i++){ arr.push({x:Math.random()*confettiCv.width, y:-Math.random()*confettiCv.height, r:Math.random()*6+3, vy:Math.random()*2+1, vx:(Math.random()-0.5)*2, hue:Math.floor(Math.random()*360)}); }
  return arr;
}
function animate(){
  if(!confettiRunning) return;
  ctx.clearRect(0,0,confettiCv.width,confettiCv.height);
  for(const p of pieces){
    p.x+=p.vx; p.y+=p.vy; if(p.y-p.r>confettiCv.height){ p.y=-10; p.x=Math.random()*confettiCv.width; }
    ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fillStyle=`hsl(${p.hue} 100% 50%)`; ctx.fill();
  }
  rafId=requestAnimationFrame(animate);
}
</script>
</body>
</html>
